name: Docker Image CI

on:
  push:
    branches: 
      - master

    tags:
      - v*

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v2
    - name: Setup Docker buildx
      id: buildx
      uses: crazy-max/ghaction-docker-buildx@v3
      with:
        buildx-version: latest
        qemu-version: latest
    - name: Build the Docker image
      run: docker buildx build .  --file Dockerfile --tag colemamd/motion-docker:latest --platform linux/arm/v7,linux/arm64,linux/amd64
    - name: Push Docker Image
      if: success()
      run: docker buildx build --output "type=image,push=true"
